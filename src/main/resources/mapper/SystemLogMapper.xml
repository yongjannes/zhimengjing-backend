<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sf.zhimengjing.mapper.admin.SystemLogMapper">

    <!-- 统计日志信息 -->
    <select id="getLogStatistics" resultType="java.util.HashMap">
        SELECT
        COUNT(*) as totalLogs,
        SUM(CASE WHEN log_level = 'ERROR' THEN 1 ELSE 0 END) as errorLogs,
        SUM(CASE WHEN log_level = 'WARN' THEN 1 ELSE 0 END) as warningLogs,
        SUM(CASE WHEN log_level = 'INFO' THEN 1 ELSE 0 END) as infoLogs,
        SUM(CASE WHEN log_level = 'DEBUG' THEN 1 ELSE 0 END) as debugLogs
        FROM system_logs
        WHERE delete_flag = 0
        <if test="startTime != null">
            AND create_time >= #{startTime}
        </if>
        <if test="endTime != null">
            AND create_time &lt;= #{endTime}
        </if>
    </select>

    <!-- 清理过期日志 -->
    <update id="cleanExpiredLogs">
        UPDATE system_logs
        SET delete_flag = 1
        WHERE create_time &lt; #{beforeTime}
          AND delete_flag = 0
    </update>

</mapper>